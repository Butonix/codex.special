var codexSpecial=(function(){var DICT={ru:{increaseSize:'Увеличить размер',decreaseSize:'Уменьшить размер'},en:{increaseSize:'Increase size',decreaseSize:'Decrease size'}};var texts=null;var nodes={toolbar:null,colorSwitchers:[],textSizeSwitcher:null};var CSS_FILE_PATH='codex-special.v.1.0.css';var pathToExtension;var classes={colorSwitchers:{blue:'special-blue',green:'special-green',white:'special-white',},textSizeIncreased:'special-big'};var initialSettings={blockId:null,lang:'ru'};var _codexSpecial=function(){};_codexSpecial.prototype.init=function(settings){fillSettings_(settings);loadStyles_();makeUI_();addListeners_();loadSettings_()};function fillSettings_(settings){for(var param in settings){initialSettings[param]=settings[param]}
pathToExtension=getScriptLocation()}
function getScriptLocation(){var scriptsList=document.getElementsByTagName('script'),scriptSrc,lastSlashPosition;for(var i=1;i<scriptsList.length;i++){scriptSrc=scriptsList[i].src;if(scriptSrc.indexOf('codex-special')!=-1){lastSlashPosition=scriptSrc.lastIndexOf('/');scriptDir=scriptSrc.substr(0,lastSlashPosition+1);return scriptDir}}}
function loadStyles_(){var style=document.createElement('link');style.setAttribute('type','text/css');style.setAttribute('rel','stylesheet');style.href=pathToExtension+CSS_FILE_PATH;document.head.appendChild(style)}
function makeUI_(){texts=DICT[initialSettings.lang];var toolbar=draw_.toolbar();var textSizeSwitcher=draw_.textSizeSwitcher();toolbar.appendChild(textSizeSwitcher);for(var color in classes.colorSwitchers){circle=draw_.colorSwitcher(color);circle.dataset.style=color;toolbar.appendChild(circle);nodes.colorSwitchers.push(circle)}
nodes.toolbar=toolbar;nodes.textSizeSwitcher=textSizeSwitcher;appendPanel_()}
function appendPanel_(){if(initialSettings.blockId){document.getElementById(initialSettings.blockId).appendChild(nodes.toolbar);nodes.toolbar.classList.add('codex-special__toolbar_included');return}
nodes.toolbar.classList.add('codex-special__toolbar_excluded');document.body.appendChild(nodes.toolbar)}
function addListeners_(){nodes.colorSwitchers.map(function(switcher,index){switcher.addEventListener('click',changeColor_,!1)});nodes.textSizeSwitcher.addEventListener('click',changeTextSize_,!1)}
function loadSettings_(){var color=localStorage.getItem('codex-special__color'),textSize=localStorage.getItem('codex-special__textSize'),textSizeSwitcher;if(color){nodes.colorSwitchers.map(function(switcher,index){if(switcher.dataset.style==color){changeColor_.call(switcher)}})}
if(textSize){textSizeSwitcher=nodes.textSizeSwitcher;changeTextSize_.call(textSizeSwitcher)}}
function changeColor_(){if(this.classList.contains('codex-special__circle_enabled')){return dropColor_()}
dropColor_();nodes.colorSwitchers.map(function(switcher,index){switcher.classList.add('codex-special__circle_disabled')});this.classList.remove('codex-special__circle_disabled');this.classList.add('codex-special__circle_enabled');localStorage.setItem('codex-special__color',this.dataset.style);document.body.classList.add(classes.colorSwitchers[this.dataset.style])}
function dropColor_(){for(var color in classes.colorSwitchers){document.body.classList.remove(classes.colorSwitchers[color])}
nodes.colorSwitchers.map(function(switcher,index){switcher.classList.remove('codex-special__circle_disabled','codex-special__circle_enabled')});localStorage.removeItem('codex-special__color')}
function changeTextSize_(){if(document.body.classList.contains(classes.textSizeIncreased)){return dropTextSize_()}
dropTextSize_();nodes.textSizeSwitcher.innerHTML='<i class="codex-special__toolbar_icon"></i> '+texts.decreaseSize;localStorage.setItem('codex-special__textSize','big');document.body.classList.add(classes.textSizeIncreased)}
function dropTextSize_(){document.body.classList.remove(classes.textSizeIncreased);nodes.textSizeSwitcher.innerHTML='<i class="codex-special__toolbar_icon"></i> '+texts.increaseSize;localStorage.removeItem('codex-special__textSize')}
var draw_={element:function(newElement,newClass){var block=document.createElement(newElement);block.classList.add(newClass);return block},toolbar:function(){return draw_.element('DIV','codex-special__toolbar')},colorSwitcher:function(type){var colorSwitcher=draw_.element('SPAN','codex-special__circle');colorSwitcher.classList.add('codex-special__circle_'+type);return colorSwitcher},textSizeSwitcher:function(){var textToggler=draw_.element('SPAN','codex-special__toolbar_text');textToggler.innerHTML='<i class="codex-special__toolbar_icon"></i> '+texts.increaseSize;return textToggler}};return new _codexSpecial()})()
